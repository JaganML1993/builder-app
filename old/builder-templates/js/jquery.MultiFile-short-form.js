window.jQuery&&function(e){"use strict";function i(e){return e>1048576?(e/1048576).toFixed(1)+"Mb":1024==e?"1Mb":(e/1024).toFixed(1)+"Kb"}e.fn.MultiFile=function(t){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var a=arguments;return this.each(function(){e.fn.MultiFile.apply(e(this),a)})}return e.fn.MultiFile[arguments[0]].apply(this,e.makeArray(arguments).slice(1)||[])}"number"==typeof t&&(t={max:t});var t=e.extend({},e.fn.MultiFile.options,t||{});e("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(e.fn.MultiFile.disableEmpty),e.fn.MultiFile.options.autoIntercept&&(e.fn.MultiFile.intercept(e.fn.MultiFile.options.autoIntercept),e.fn.MultiFile.options.autoIntercept=null),this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var a=window.MultiFile,l={e:this,E:e(this),clone:e(this).clone()},n=e.extend({},e.fn.MultiFile.options,t||{},(e.metadata?l.E.metadata():e.meta?l.E.data():null)||{},{});n.max>0||(n.max=l.E.attr("maxlength")),n.max>0||(n.max=(String(l.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.max>0?n.max=String(n.max).match(/[0-9]+/gi)[0]:n.max=-1),n.max=new Number(n.max),n.accept=n.accept||l.E.attr("accept")||"",n.accept||(n.accept=l.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",n.accept=new String(n.accept).replace(/^(accept|ext)\-/i,"")),n.maxsize=n.maxsize>0?n.maxsize:l.E.data("maxsize")||0,n.maxsize>0||(n.maxsize=(String(l.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.maxsize>0?n.maxsize=String(n.maxsize).match(/[0-9]+/gi)[0]:n.maxsize=-1),n.maxfile=n.maxfile>0?n.maxfile:l.E.data("maxfile")||0,n.maxfile>0||(n.maxfile=(String(l.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.maxfile>0?n.maxfile=String(n.maxfile).match(/[0-9]+/gi)[0]:n.maxfile=-1),n.maxfile>1&&(n.maxfile=1024*n.maxfile),n.maxsize>1&&(n.maxsize=1024*n.maxsize),n.max>1&&l.E.attr("multiple","multiple").prop("multiple",!1),e.extend(l,n||{}),l.STRING=e.extend(l.STRING||{},e.fn.MultiFile.options.STRING,l.STRING),e.extend(l,{n:0,slaves:[],files:[],instanceKey:l.e.id||"MultiFile"+String(a),generateID:function(e){return l.instanceKey+(e>0?"_F"+String(e):"")},trigger:function(i,t,a,l){var n,r=a[i]||a["on"+i];return r?(l=l||a.files||(this.files?this.files[0]:null)||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],e.each(l,function(e,i){n=r(t,i.name,a,i)}),n):void 0}}),String(l.accept).length>1&&(l.accept=l.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),l.rxAccept=new RegExp("\\.("+(l.accept?l.accept:"")+")$","gi")),l.wrapID=l.instanceKey+"_wrap",l.E.wrap('<div class="MultiFile-wrap" id="'+l.wrapID+'"><div class="upload-button-wrap"></div><label class="info">Attach max 4 files (10MB each). Else contact us for FTP details.</label></div>'),l.wrapper=e("#"+l.wrapID),l.e.name=l.e.name||"file"+a+"[]",l.list||(l.wrapper.append('<div class="MultiFile-list" id="'+l.wrapID+'_list"></div>'),l.list=e("#"+l.wrapID+"_list")),l.list=e(l.list),l.addSlave=function(t,n){l.n++,t.MultiFile=l,n>0&&(t.id=t.name=""),n>0&&(t.id=l.generateID(n)),t.name=String(l.namePattern.replace(/\$name/gi,e(l.clone).attr("name")).replace(/\$id/gi,e(l.clone).attr("id")).replace(/\$g/gi,a).replace(/\$i/gi,n));var r;l.max>0&&l.files.length>l.max&&(t.disabled=!0,r=!0),l.current=l.slaves[n]=t,t=e(t),t.val("").attr("value","")[0].value="",t.addClass("MultiFile-applied"),t.change(function(a,r,s){e(this).blur();var c=this,o=l.files||[],u=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],m=[],p=0,f=l.total_size||0,d=[];e.each(u,function(e,i){m[m.length]=i}),l.trigger("FileSelect",this,l,m),e.each(u,function(e,t){var a=t.name,n=t.size,r=function(e){return e.replace("$ext",String(a.match(/[^\.]+$/i)||"")).replace("$file",a.match(/[^\/\\]+$/gi)).replace("$size",i(n)+" > "+i(l.maxfile))};l.accept&&a&&!a.match(l.rxAccept)&&(d[d.length]=r(l.STRING.denied),l.trigger("FileInvalid",this,l,[t]));for(var s in l.slaves)if(l.slaves[s]&&l.slaves[s]!=c){var o=(l.slaves[s].value||"").replace(/^C:\\fakepath\\/gi,"");(a==o||a==o.substr(o.length-a.length))&&(d[d.length]=r(l.STRING.duplicate),l.trigger("FileDuplicate",this,l,[t]))}l.maxfile>0&&n>0&&n>l.maxfile&&(d[d.length]=r(l.STRING.toobig),l.trigger("FileTooBig",this,l,[t]));var u=l.trigger("FileValidate",this,l,[t]);u&&""!=u&&(d[d.length]=r(u)),p+=t.size}),f+=p,m.size=p,m.total=f,m.total_length=m.length+o.length,l.max>0&&o.length+u.length>l.max&&(d[d.length]=l.STRING.toomany.replace("$max",l.max),l.trigger("FileTooMany",this,l,m)),l.maxsize>0&&f>l.maxsize&&(d[d.length]=l.STRING.toomuch.replace("$size",i(f)+" > "+i(l.maxsize)),l.trigger("FileTooMuch",this,l,m));var g=e(l.clone).clone();return g.addClass("MultiFile"),d.length>0?(l.error(d.join("\n\n")),l.n--,l.addSlave(g[0],n),t.parent().prepend(g),t.remove(),!1):(l.total_size=f,u=o.concat(m),u.size=f,u.size_label=i(f),l.files=u,e(this).css({position:"absolute",top:"-3000px"}),t.after(g),l.addSlave(g[0],n+1),l.addToList(this,n,m),l.trigger("afterFileSelect",this,l,m),void 0)}),e(t).data("MultiFile",l),r&&e(t).attr("disabled","disabled").prop("disabled",!0)},l.addToList=function(t,a,n){l.trigger("FileAppend",t,l,n);var r=e("<span/>");e.each(n,function(a,n){var s=String(n.name||""),c=l.STRING,o=c.label||c.file||c.name,u=c.title||c.tooltip||c.selected,m='<img class="MultiFile-preview" style="'+l.previewCss+'"/>',p=e(('<span class="MultiFile-label" title="'+u+'"><span class="MultiFile-title">'+o+"</span>"+(l.preview||e(t).is(".with-preview")?m:"")+"</span>").replace(/\$(file|name)/gi,(s.match(/[^\/\\]+$/gi)||[s])[0]).replace(/\$(ext|extension|type)/gi,(s.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(n.size||0)).replace(/\$(preview)/gi,m));p.find("img.MultiFile-preview").each(function(){var e=this,i=new FileReader;i.readAsDataURL(n),i.onload=function(i){e.src=i.target.result}}),a>1&&r.append(", "),r.append(p)});var s=e('<div class="MultiFile-label"></div>'),c=e('<a class="MultiFile-remove" href="#'+l.wrapID+'"><img src="/images/file-delete-icon.png" alt="Delete" title="Delete" /></a>').click(function(){l.trigger("FileRemove",t,l,s),l.n--,l.current.disabled=!1,l.slaves[a]=null,e(t).remove(),e(this).parent().remove(),e(l.current).css({position:"",top:""}),e(l.current).reset().val("").attr("value","")[0].value="";var i=[];for(var n in l.slaves){var r=l.slaves[n];if(null!=r&&void 0!=r){var s=(r.files&&r.files.length?r.files:null)||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}];e.each(s,function(e,t){void 0!=t.name&&(i[i.length]=t)})}}return l.files=i,l.trigger("afterFileRemove",t,l,s),l.trigger("FileChange",t,l,l.files),!1});l.list.append(s.append(c," ",r)),l.trigger("afterFileAppend",t,l,n),l.trigger("FileChange",t,l,l.files)},l.MultiFile||l.addSlave(l.e,0),l.n++,l.E.data("MultiFile",l)})},e.extend(e.fn.MultiFile,{reset:function(){var i=e(this).data("MultiFile");return i&&i.list.find("a.MultiFile-remove").click(),e(this)},files:function(){var e=this.data("MultiFile");return e?e.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var e=this.data("MultiFile");return e?e.total_size||[]:!console.log("MultiFile plugin not initialized")},count:function(){var e=this.data("MultiFile");return e?e.files.length||[]:!console.log("MultiFile plugin not initialized")},disableEmpty:function(i){i=("string"==typeof i?i:"")||"mfD";var t=[];return e("input:file.MultiFile").each(function(){""==e(this).val()&&(t[t.length]=this)}),window.clearTimeout(e.fn.MultiFile.reEnableTimeout),e.fn.MultiFile.reEnableTimeout=window.setTimeout(e.fn.MultiFile.reEnableEmpty,500),e(t).each(function(){this.disabled=!0}).addClass(i)},reEnableEmpty:function(i){return i=("string"==typeof i?i:"")||"mfD",e("input:file."+i).removeClass(i).each(function(){this.disabled=!1})},intercepted:{},intercept:function(i,t,a){var l,n;if(a=a||[],a.constructor.toString().indexOf("Array")<0&&(a=[a]),"function"==typeof i)return e.fn.MultiFile.disableEmpty(),n=i.apply(t||window,a),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n;i.constructor.toString().indexOf("Array")<0&&(i=[i]);for(var r=0;r<i.length;r++)l=i[r]+"",l&&function(i){e.fn.MultiFile.intercepted[i]=e.fn[i]||function(){},e.fn[i]=function(){return e.fn.MultiFile.disableEmpty(),n=e.fn.MultiFile.intercepted[i].apply(this,arguments),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n}}(l)}}),e.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,namePattern:"$name",preview:!1,previewCss:"max-height:100px; max-width:100px;",STRING:{remove:"Remove:",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toomany:"Only $max files are allowed",toobig:"$file is too big (max $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(e){"undefined"!=typeof console&&console.log(e),alert(e)}},e.fn.reset=e.fn.reset||function(){return this.each(function(){try{this.reset()}catch(e){}})},e(function(){e("input[type=file].multi").MultiFile()})}(jQuery);